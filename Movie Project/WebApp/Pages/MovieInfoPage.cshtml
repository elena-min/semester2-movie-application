@page
@using DAL;
@using LogicLayer.Classes;
@using LogicLayer.Controllers;
@using LogicLayer.Interfaces;
@model WebApp.Pages.MovieInfoPageModel
@{
    Layout = "_LayoutMain";

    @functions {
        static IReviewDAL iReviewDAL = new ReviewDAL();
        static ReviewController reviewController = new ReviewController(iReviewDAL);
        static IMediaItemDAL iMediaItemDAL = new MediaItemDAL();
        static MediaItemController mediaController = new MediaItemController(iMediaItemDAL);
        static IUserDAL iuserDAL = new UserDAL();
        static UserController userController = new UserController(iuserDAL);
    }
}


<main class="main-movie-info">

    <div class="information">
        <div id="info1">
            <h2><b>@Model.Movie.Title</b></h2><br>
            <h6><b>Director: </b><i>@(((Movie)Model.Movie).Director)</i></h6>
        </div>
        
        <div class="ratings">
            <div id="rating">
                <p><b>RATING:</b> </p>
                <div class="ratingIMG">
                    <img src="/images/icons8-rating-48.png" alt="img" style="padding:5px">
                    <p>@Model.Movie.Rating /10</p>
                </div>
                    
            </div>
            <div id="userRating">
                <p><b>USER RATING:</b> </p>
                <div class="ratingIMG">
                    <img src="/images/icons8-review-48.png" alt="img" style="padding:5px">
                    @{
                        if (mediaController.GetAllGivenRatings(@Model.Movie.GetId()).Length != 0)
                        {
                            foreach (int rating in mediaController.GetAllGivenRatings(@Model.Movie.GetId()))
                            {
                                Model.Movie.AddRating(rating);
                            }
                            <p>@Model.Movie.CalculateAverageRating() /10</p>
                        }
                        else
                        {
                            <p>None.</p>
                        }
                    }
                </div>
                
            </div>
            <div id="userRatingNr">
                <p><b>RATINGS NR:</b> </p>
                <div class="ratingIMG">
                    <img src="/images/icons8-review-50.png" alt="img" style="padding:5px">
                    @{
                        if (mediaController.GetAllGivenRatings(@Model.Movie.GetId()).Length != 0)
                        {
                            foreach (int rating in mediaController.GetAllGivenRatings(@Model.Movie.GetId()))
                            {
                                Model.Movie.AddRating(rating);
                            }
                            <p>@Model.Movie.GetAllRatings()</p>
                        }
                        else
                        {
                            <p>None.</p>
                        }
                    }
                </div>
                
            </div>

        </div>
        <div></div>
        <p><b>Description:</b></p>
        <p>@Model.Movie.Description</p>
        @{
            string genresString = string.Join(", ", Model.Movie.GetAllGenres());
        }
        <p><b>Genres :</b> @genresString</p>
        <p><b>Writer(s) :</b> @(((Movie)Model.Movie).Writer)</p>
        <p><b>Cast :</b> @Model.Movie.Cast.ToString()</p>
        <p><b>Release date :</b> @(((Movie)Model.Movie).ReleaseDate.ToString("dd-MM-yyyy"))</p>
        <p><b>Country of origin :</b> @Model.Movie.CountryOfOrigin</p>
        <p><b>Duration : </b>@(((Movie)Model.Movie).Duration.ToString())</p>

        @{
            if (mediaController.GetAllGivenRatings(@Model.Movie.GetId()).Length != 0)
            {
                foreach (int rating in mediaController.GetAllGivenRatings(@Model.Movie.GetId()))
                {
                    Model.Movie.AddRating(rating);
                }
                <p>
                    <b> User given rating:</b> @Model.Movie.CalculateAverageRating()

                </p>
            }
            else
            {
                <p> <b>User given rating:</b> no reviews yet.</p>
            }
        }
    </div>
    <div class="cover">
        <img src="data:image;base64,@mediaController.GetMediaItemImageByID(@Model.Movie.GetId())" alt="Movie cover" style="padding:10px">
    </div>
    @if (User.Identity.IsAuthenticated)
    {

        <br />
        <div id="writeReview">
            <a asp-page="/ReviewPage" asp-route-movieId="@Model.Movie.GetId()" class="btn btn-primary">Write a review</a>
        </div>
        <form method="post">
            <button type="submit" name="productId" value="@Model.Movie.GetId()">Add to Favorites</button>
        </form>

    }

</main>
<br />
